var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&s(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&s(e,a,t[a]);return e};import{a as o,D as c,m,n as d,d as u,R as p,o as x,b as E,r as h,c as f}from"./vendor.1454f923.js";let v=!1;Notification.requestPermission((e=>{"granted"===e&&(v=!0)}));const g=new Worker("./notification.worker.js");var y,N;g.addEventListener("message",(e=>{const t=e.data;v&&new Notification(t.title)})),(N=y||(y={})).EveryDay="day",N.EveryWeek="week",N.EveryMonth="month",N.EveryYear="year",N.Custom="custom";const b=new class{constructor(){this.groups=[],this.defaultLists=[{id:"0",icon:"sun-line",title:"我的一天"},{id:"1",icon:"home-5-line",title:"任务"}],this.userLists=[],this.currList=this.defaultLists[0],this.todos=[],this.currTodo=null,m(this)}setCurrTodo(e){this.currTodo=e}setCurrListById(e){var t,a;e!==this.currList.id&&(1===e.length?this.currList=null!=(t=this.defaultLists.find((t=>t.id===e)))?t:this.defaultLists[0]:this.currList=null!=(a=this.userLists.find((t=>t.id===e)))?a:this.defaultLists[0],this.setCurrTodo(null))}addTodo(e,n){const l=(r=i({},n),s={id:d(),listId:[e],title:n.title,status:!1,createAt:u()},t(r,a(s)));var r,s;return this.todos.push(l),l}updateTodo(e,t){var a;const n=this.todos.findIndex((t=>t.id===e.id));t.repeat&&!this.todos[n].deadline&&(t.deadline=u().endOf("day")),this.todos[n]=i(i({},e),t),(null==(a=this.currTodo)?void 0:a.id)===e.id&&(this.currTodo=this.todos[n])}removeTodo(e){const t=this.todos.findIndex((t=>t.id===e));this.todos.splice(t,1)}getAllTodos(e){return e?this.todos.filter((t=>t.listId.includes(e))):this.todos}setTodoStatus(e,t){var a,n;if(e.status=t,e.repeat&&t){if(e.alreadyRepeat)return;e.alreadyRepeat=!0;const t=i({},e);t.deadline=null==(a=e.deadline)?void 0:a.add(1,e.repeat),t.notification=null==(n=e.notification)?void 0:n.add(1,e.repeat),t.alreadyRepeat=!1,this.addTodo(t.listId[0],i({},t))}}addTodoStep(e,t){e.step||(e.step=[]);const a={id:d(),title:t,status:!1};return e.step.push(a),a}setTodoSteps(e,t){e.step=t}addList(){const e={id:d(),icon:"list-unordered",title:"无标题列表"};return this.userLists.push(e),e.id}editList(e,t){var a;const n=this.userLists.find((t=>t.id===e));return!!n&&(n.title=t.title?t.title:n.title,n.icon=null!=(a=t.icon)?a:n.icon,!0)}addGroup(e){this.groups.push(e)}};o((()=>{g.postMessage(JSON.stringify(b.todos))}));const C=c.exports.createContext(b);var k,w;(w=k||(k={}))[w.Normal=0]="Normal",w[w.Editing=1]="Editing",w[w.Actived=2]="Actived";const L=e=>{const t=e.icon?" ri-"+e.icon:" ri-list-unordered",a=c.exports.useRef(null);c.exports.useEffect((()=>{var e,t;null==(e=a.current)||e.focus(),null==(t=a.current)||t.select()}),[]);const[n,l]=c.exports.useState("无标题列表"),r=e=>{l(e.target.value)},s=t=>{e.onBlur&&e.onBlur(t.target.value)},i=t=>{"Enter"===t.key&&e.onBlur&&e.onBlur(t.target.value)};if(1===e.type)return p.createElement("div",{className:"flex text-sm text-white mr-1 border border-gray-700"},p.createElement("i",{className:"ml-1 py-3 px-4 hover:bg-white hover:bg-opacity-5"+t}),p.createElement("input",{ref:a,className:"title py-3 focus:outline-none bg-transparent border-none",value:n,onKeyUp:i,onChange:r,onBlur:s}));return p.createElement("div",{className:"flex relative px-5 py-3 text-sm text-white cursor-pointer hover:bg-white hover:bg-opacity-5"+(0===e.type?"":" text-purple-400 actived-indicator"),onClick:()=>{e.onSelect&&e.onSelect()}},p.createElement("i",{className:"mr-4"+t}),p.createElement("div",{className:"title text-opacity-80"},e.title),p.createElement("div",{className:"badge"}))};L.defaultProps={type:0};const T=e=>(c.exports.useContext(C),p.createElement("div",{className:"flex"},p.createElement("div",{className:"flex flex-1 px-5 py-3 text-sm text-white cursor-pointer hover:bg-white hover:bg-opacity-5",onClick:e.addList},p.createElement("i",{className:"ri-add-line mr-4"}),p.createElement("div",{className:"title text-opacity-80"},"新建列表")),p.createElement("div",{className:"p-3 cursor-pointer hover:bg-white hover:bg-opacity-5"},p.createElement("i",{className:"ri-folder-add-line text-sm text-white"}))));var S,I,O=x((()=>{const e=c.exports.useContext(C),[t,a]=c.exports.useState(""),[n,l]=c.exports.useState("0"),r=n=>{e.editList(t,{title:n}),a(""),l(t)},s=t=>{l(t),e.setCurrListById(t),x()},i=e=>e===t?k.Editing:e===n?k.Actived:k.Normal,[o,m]=c.exports.useState("-left-80"),[d,u]=c.exports.useState("hidden md:hidden"),x=()=>{m("-left-80"),u("hidden md:hidden")};return p.createElement(p.Fragment,null,p.createElement("button",{className:"absolute md:hidden z-20 text-white text-2xl top-0 left-6 p-2 hover:bg-black hover:bg-opacity-20",onClick:()=>{m("left-0"),u("absolute inset-0 z-10 bg-black bg-opacity-40 md:hidden")}},p.createElement("i",{className:"ri-menu-2-line "})),p.createElement("div",{className:d,onClick:x}),p.createElement("div",{className:`absolute top-0 z-20 w-80 md:static min-h-screen bg-black bg-opacity-90 transition-all ${o}`},p.createElement("div",{className:"text-white p-3 font-thin text-opacity-60 text-sm"},"Dolldo"),e.defaultLists.map((e=>p.createElement(L,{key:e.id,icon:e.icon,title:e.title,type:i(e.id),onSelect:()=>s(e.id)}))),p.createElement("hr",{className:"border-opacity-25 mx-6 my-2"}),e.userLists.map((e=>p.createElement(L,{key:e.id,icon:e.icon,title:e.title,type:i(e.id),onBlur:r,onSelect:()=>s(e.id)}))),p.createElement(T,{addList:()=>{l("");const t=e.addList();a(t),e.setCurrListById(t)}})))}));(I=S||(S={}))[I.Normal=0]="Normal",I[I.Input=1]="Input";const M=()=>{const e=c.exports.useContext(C),[t,a]=c.exports.useState(""),[n,l]=c.exports.useState(0),r=c.exports.useRef(null),s=()=>{t.trim()&&e.addTodo(e.currList.id,{title:t}),a("")};return p.createElement("div",{className:"flex-none pb-8 pt-2"},p.createElement("div",{className:"flex h-12 px-4 items-center rounded-md text-white text-sm bg-black bg-opacity-80 hover:bg-gray-900",onClick:()=>{var e;l(1),null==(e=r.current)||e.focus()}},p.createElement("i",{className:(0===n?"ri-add-line":"ri-checkbox-blank-circle-line")+" text-lg mr-4",onClick:s}),p.createElement("input",{ref:r,className:"flex-1 bg-transparent focus:outline-none",type:"text",placeholder:"添加任务",value:t,onBlur:()=>{t||l(0)},onKeyUp:e=>{"Enter"===e.key&&s()},onChange:e=>a(e.target.value)})))};var D="_check-btn_iytd8_1";const B=e=>{const t=D+" "+e.className+(e.checked?" ri-checkbox-circle-fill":" ri-checkbox-blank-circle-line");return p.createElement("i",{className:t,onClick:()=>{e.onChange&&e.onChange(!e.checked)}})};B.defaultProps={className:"text-white text-opacity-70 text-2xl"};var P=x((e=>{const t=c.exports.useContext(C),[a,n]=c.exports.useState(e.todo.status),l=e.todo.step&&e.todo.step.length>0&&`第 ${e.todo.step.filter((e=>e.status)).length} 步，共 ${e.todo.step.length} 步`,r=e.todo.deadline&&p.createElement(p.Fragment,null,p.createElement("i",{className:"ri-calendar-line"}),(e=>{const t=u().endOf("day").diff(e,"day");return 0===t?"今天":1===t?"昨天":-1===t?"明天":e.format("MMMDD日，ddd")})(e.todo.deadline)),s=e.todo.repeat&&p.createElement("i",{className:"ri-refresh-line"}),i=e.todo.notification&&p.createElement("i",{className:"ri-notification-line"});return p.createElement("div",{className:"flex rounded-md items-center px-4 bg-gray-900 h-12 mb-1 hover:bg-gray-800",onClick:()=>{t.currTodo===e.todo?t.setCurrTodo(null):t.setCurrTodo(e.todo)}},p.createElement(B,{checked:a,onChange:a=>{t.setTodoStatus(e.todo,a),n(a)}}),p.createElement("section",{className:"ml-4"},p.createElement("div",{className:"text-sm text-white"},e.todo.title),p.createElement("div",{className:"flex items-center text-gray-400 text-xs"},p.createElement("span",{className:"flex items-center mr-1"},l),p.createElement("span",{className:"flex items-center mr-1"},r),p.createElement("span",{className:"flex items-center mr-1"},s),p.createElement("span",{className:"flex items-center"},i))))}));var $=x((()=>{const e=c.exports.useContext(C),t=e.getAllTodos(e.currList.id),[a,n]=c.exports.useState(!0),l=a?"rotate-90":"",r=t.filter((e=>!e.status)),s=t.filter((e=>e.status));return p.createElement("div",{className:"todo-list flex-1 py-4 overflow-y-auto"},r.map((e=>p.createElement(P,{todo:e,key:e.id}))),s.length>0&&p.createElement("button",{className:"flex items-center text-gray-300 text-sm bg-black bg-opacity-50 rounded p-1 pr-2 mb-1 hover:bg-opacity-70 hover:text-white",onClick:()=>{n(!a)}},p.createElement("i",{className:"transition-all transform ri-arrow-right-s-line "+l}),p.createElement("span",{className:"px-1"},"已完成"),p.createElement("span",null,s.length)),a?s.map((e=>p.createElement(P,{todo:e,key:e.id}))):"")}));var j=x((()=>{const e=c.exports.useContext(C),t="list-unordered"!==e.currList.icon?"mr-4 ri-"+e.currList.icon:"";return p.createElement("div",{className:"content-container flex-1 flex flex-col pt-12 md:pt-8 px-8 min-h-screen max-h-screen"},p.createElement("div",{className:"title pb-4 flex relative text-white text-2xl font-semibold"},p.createElement("i",{className:t}),p.createElement("div",null,e.currList.title)),p.createElement($,null),p.createElement(M,null))})),_="_todo-step_1ms20_4",A="_remove-btn_1ms20_25";const H=e=>{const[t,a]=c.exports.useState(!1),n=e.value?[...e.value]:[];return p.createElement(p.Fragment,null,n.map((t=>p.createElement("div",{key:t.id,className:`${_} flex items-center px-4 hover:bg-gray-100`},p.createElement(B,{checked:t.status,onChange:a=>{return n=t.id,l=a,e.value.find((e=>e.id===n)).status=l,void(e.onChange&&e.onChange(e.value));var n,l},className:"font-bold text-lg ml-0.5 mr-5"}),p.createElement("input",{className:"text-sm flex-1 py-3 bg-transparent focus:outline-none border-b",defaultValue:t.title,onChange:a=>((t,a)=>{e.value.find((e=>e.id===a)).title=t.target.value,e.onChange&&e.onChange(e.value)})(a,t.id)}),p.createElement("i",{className:`${A} ri-close-line text-xl cursor-pointer`,onClick:()=>(t=>{const a=e.value?[...e.value]:[],n=a.findIndex((e=>e.id===t));a.splice(n,1),e.onChange&&e.onChange(a)})(t.id)})))),p.createElement("div",{className:"flex items-center py-3 px-4 "},t?p.createElement("i",{className:"ri-checkbox-blank-circle-line font-bold text-lg ml-0.5 mr-5"}):p.createElement("i",{className:"ri-add-line font-bold text-lg ml-0.5 mr-5 text-blue-500"}),p.createElement("input",{className:`${_} text-sm outline-none text-black`,placeholder:t?"":"添加步骤",onFocus:()=>{a(!0)},onBlur:()=>{a(!1)},onKeyUp:t=>{"Enter"===t.key&&(e.onChange&&e.onChange(t.target.value),t.target.value="")}})))},R=e=>{const t=e.actived?"text-blue-500":"";return p.createElement("div",{className:"cell bg-white flex items-center text-gray-500  px-5 border mb-2 hover:bg-gray-100 cursor-pointer",onClick:e.onClick},p.createElement("i",{className:`ri-${e.icon} mr-4 ${t}`}),e.caption?p.createElement("div",{className:"title flex-1 py-1 "},p.createElement("div",{className:"text-blue-500"},e.title),p.createElement("div",{className:"text-xs"},e.caption)):p.createElement("div",{className:`title flex-1 py-3 ${t}`},e.title),e.actived&&p.createElement("i",{className:"ri-close-line text-xl",onClick:t=>{t.stopPropagation(),e.onClear&&e.onClear()}}))};R.defaultProps={actived:!1};const F=e=>p.createElement("div",{className:"cell-group"},e.children);const z=e=>p.createElement("ul",{className:"bg-white",onClick:t=>{e.onClick&&e.onClick(t.target,t.target.dataset.menuId)}},e.children);z.Item=e=>p.createElement("li",{className:`menu-item p-3 cursor-pointer hover:bg-gray-100 ${e.className}`,"data-menu-id":e.index,onClick:e.onClick},e.children);const K={[y.EveryDay]:"每天",[y.EveryWeek]:"每周",[y.EveryMonth]:"每月",[y.EveryYear]:"每年"};const U=()=>{const e=document.getElementsByTagName("body");return E.exports.createPortal(p.createElement("div",{className:"absolute inset-0 opacity-0"}),e[0])},W=e=>e.visible?p.createElement(p.Fragment,null,p.createElement(U,null),p.createElement("div",{className:"absolute m-2 z-50 w-60 left-0 p-2 shadow bg-white rounded "},e.children)):p.createElement(p.Fragment,null),Y=e=>{const[t,a]=c.exports.useState(!1),n=p.Children.only(e.children),l={onClick:e=>{a((e=>!e)),e.stopPropagation()}},r=p.cloneElement(n,l),s=()=>a(!1);return c.exports.useEffect((()=>(window.addEventListener("click",s),()=>{window.removeEventListener("click",s)})),[]),p.createElement("div",{className:"relative"},r,p.createElement(W,{visible:t},e.overlay))};Y.Notification=e=>{const t=u().add(3,"h").minute(0),a=u().add(1,"d").hour(9).minute(0),n=u().add(7,"d").day(1).hour(9).minute(0),l=!!e.value,r=e.value?`在 ${e.value.format("HH:mm")} 时提醒我`:"提醒我";let s=(i=e.value)?i.isBefore(u().startOf("week"))||i.isAfter(u().endOf("week"))?i.format("MMMDD日，ddd"):i.format("ddd"):"";var i;const o=p.createElement(z,{onClick:(l,r)=>{let s=u();"1"===r&&(s=t),"2"===r&&(s=a),"3"===r&&(s=n),e.onChange&&e.onChange(s)}},p.createElement(z.Item,{className:"flex items-center text-gray-500",index:"1"},p.createElement("i",{className:"ri-time-line mr-2"}),p.createElement("span",{className:"flex-1"},"今日晚些时候"),p.createElement("span",{className:"text-sm"},t.format("HH:mm"))),p.createElement(z.Item,{className:"flex items-center text-gray-500",index:"2"},p.createElement("i",{className:"ri-skip-forward-mini-line mr-2"}),p.createElement("span",{className:"flex-1"},"明天"),p.createElement("span",{className:"text-sm"},a.format("ddd HH:mm"))),p.createElement(z.Item,{className:"flex items-center text-gray-500",index:"3"},p.createElement("i",{className:"ri-speed-mini-line mr-2"}),p.createElement("span",{className:"flex-1"},"下周"),p.createElement("span",{className:"text-sm"},n.format("ddd HH:mm"))));return p.createElement(Y,{overlay:o},p.createElement(R,{icon:"alarm-line",title:r,caption:s,actived:l,onClear:()=>{e.onChange&&e.onChange(null)}}))},Y.Deadline=e=>{const t=u().endOf("day"),a=u().add(1,"d").endOf("day"),n=u().add(7,"d").startOf("week").endOf("day"),l=p.createElement(z,{onClick:(l,r)=>{let s=u();"1"===r&&(s=t),"2"===r&&(s=a),"3"===r&&(s=n),e.onChange&&e.onChange(s)}},p.createElement(z.Item,{className:"flex items-center text-gray-500",index:"1"},p.createElement("i",{className:"ri-calendar-event-line mr-2"}),p.createElement("span",{className:"flex-1"},"今天"),p.createElement("span",{className:"text-sm"},t.format("ddd"))),p.createElement(z.Item,{className:"flex items-center text-gray-500",index:"2"},p.createElement("i",{className:"ri-calendar-2-line mr-2"}),p.createElement("span",{className:"flex-1"},"明天"),p.createElement("span",{className:"text-sm"},a.format("ddd"))),p.createElement(z.Item,{className:"flex items-center text-gray-500",index:"3"},p.createElement("i",{className:"ri-calendar-todo-line mr-2"}),p.createElement("span",{className:"flex-1"},"下周"),p.createElement("span",{className:"text-sm"},n.format("ddd")))),r=!!e.value,s=(e=>{if(!e)return"添加截止日期";const t=u().endOf("day").diff(e,"day");return 0===t?"今天 到期":1===t?"昨天 到期":-1===t?"明天 到期":e.format("MMMDD日，ddd")+" 到期"})(e.value);return p.createElement(Y,{overlay:l},p.createElement(R,{icon:"calendar-todo-line",title:s,actived:r,onClear:()=>{e.onChange&&e.onChange(null)}}))},Y.Repeat=e=>{const t=p.createElement(z,{onClick:(t,a)=>{e.onChange&&e.onChange(a)}},Object.keys(K).map((e=>p.createElement(z.Item,{className:"flex items-center text-gray-500",key:e,index:e},p.createElement("i",{className:"ri-calendar-event-line mr-2"}),p.createElement("span",{className:"flex-1"},K[e]))))),a=!!e.value,n=e.value?K[e.value]:"重复";return p.createElement(Y,{overlay:t},p.createElement(R,{icon:"repeat-2-line",actived:a,title:n,onClear:()=>{e.onChange&&e.onChange(null)}}))};var q=x((()=>{const e=c.exports.useContext(C),{currTodo:t}=e;return t?p.createElement("div",{className:"flex flex-col w-96 min-h-screen max-h-screen"},p.createElement("div",{className:"body flex-1 overflow-y-auto bg-gray-100"},p.createElement("div",{className:"pt-8 pb-2 bg-white"},p.createElement("div",{className:"title flex items-center px-4 pb-2 text-gray-800 text-lg font-bold"},p.createElement(B,{className:"text-2xl mr-4",checked:t.status,onChange:a=>{e.setTodoStatus(t,a)}}),p.createElement("input",{className:"font-bold outline-none "+(t.status?"line-through":""),value:t.title,onChange:a=>{const n=a.target.value;e.updateTodo(t,{title:n})}})),p.createElement(H,{value:t.step&&[...t.step],onChange:a=>{"string"==typeof a?e.addTodoStep(t,a):a&&e.setTodoSteps(t,a)}})),p.createElement("div",{className:"p-2 "},"0"!==e.currList.id&&p.createElement(R,{icon:"sun-line",title:"添加到“我的一天”"}),p.createElement(F,null,p.createElement(Y.Notification,{value:t.notification,onChange:a=>{e.updateTodo(t,{notification:a})}}),p.createElement(Y.Deadline,{value:t.deadline,onChange:a=>{e.updateTodo(t,{deadline:a})}}),p.createElement(Y.Repeat,{value:t.repeat,onChange:a=>{e.updateTodo(t,{repeat:a})}})))),p.createElement("div",{className:"footer flex items-center justify-between bg-white p-4 py-2"},p.createElement("i",{className:"ri-arrow-right-s-line text-2xl cursor-pointer",onClick:()=>{e.setCurrTodo(null)}}),p.createElement("span",{className:"text-sm text-gray-700"},"创建于 ",t.createAt.format("MMMDD日，ddd")),p.createElement("i",{className:"ri-delete-bin-line cursor-pointer",onClick:()=>{e.removeTodo(t.id),e.setCurrTodo(null)}}))):p.createElement(p.Fragment,null)}));var G=x((()=>(c.exports.useContext(C),p.createElement("div",{className:"flex flex-row"},p.createElement(O,null),p.createElement(j,null),p.createElement(q,null)))));function J(){return p.createElement(G,null)}u.locale("zh-cn"),u.extend(h),f.render(p.createElement(p.StrictMode,null,p.createElement(C.Provider,{value:b},p.createElement(J,null))),document.getElementById("root"));
